WITH morning_avg AS(
    SELECT 
        AVG(sleep_duration) AS sleep_duration_avg,
        AVG(sleep_quality) AS sleep_quality_avg,
        AVG(morning_mood) AS morning_mood_avg 
    FROM 
        morning 
    WHERE 
        morning.user_id = $1 
        AND CURRENT_DATE - 7 <= morning.date
        AND morning.date <= CURRENT_DATE
), evening_avg AS (
    SELECT 
        AVG(sport_time) AS sport_time_avg,
        AVG(study_time) AS study_time_avg,
        AVG(evening_mood) AS evening_mood_avg 
    FROM 
        evening 
    WHERE 
        evening.user_id = $1
        AND CURRENT_DATE - 7 <= evening.date
        AND evening.date <= CURRENT_DATE
)

SELECT 
    sleep_duration_avg,
    sport_time_avg,
    study_time_avg,
    sleep_quality_avg,
    (morning_mood_avg::decimal + evening_mood_avg ::decimal) / 2 AS mood_avg
FROM
    morning_avg, evening_avg

